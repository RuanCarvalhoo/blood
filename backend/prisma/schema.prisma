generator client {
	provider = "prisma-client-js"
}

datasource db {
	provider = "postgresql"
	url      = env("DATABASE_URL")
}

enum BloodType {
	A_POS
	A_NEG
	B_POS
	B_NEG
	AB_POS
	AB_NEG
	O_POS
	O_NEG
}

enum Gender {
	MALE
	FEMALE
}

enum PatientType {
	EMERGENCY_SURGERY
	ONCOLOGIC
	TRAFFIC_ACCIDENT
	COMPLICATED_DELIVERY
	CHILD_ANEMIA
	ELECTIVE_SURGERY
	ELDERLY_PATIENT
	HEMATOLOGIC_DISEASE
}

enum UsageDescription {
	CARDIAC_SURGERY_TRANSFUSION
	LEUKEMIA_TREATMENT
	MULTIPLE_TRAUMA_REPLACEMENT
	POSTPARTUM_HEMORRHAGE
	SEVERE_ANEMIA_TREATMENT
	LIVER_TRANSPLANT_SURGERY
	DIGESTIVE_ULCER_TREATMENT
	APLASTIC_ANEMIA_TRANSFUSION
}

enum HospitalName {
	HOSPITAL_CENTRAL
	HOSPITAL_SANTA_FE
	MATERNIDADE_SAO_JOSE
}

model User {
	id                      String   @id @default(uuid())
	name                    String
	telephone               String
	email                   String   @unique
	password                String
	bloodType               BloodType
	gender                  Gender
	level                   Int      @default(1)
	points                  Int      @default(0)
	totalDonations          Int      @default(0)
	lastDonationDate        DateTime?
	nextDonationDate        DateTime?
	expoPushToken           String?
	notificationsEnabled    Boolean  @default(true)
	reminderDaysBefore      Int      @default(3)
	badges                  UserBadge[]
	donations               Donation[]
	notifications           Notification[]
	createdAt               DateTime @default(now())
	updatedAt               DateTime @updatedAt
}

model Donation {
	id             String           @id @default(uuid())
	user           User             @relation(fields: [userId], references: [id])
	userId         String
	date           DateTime
	location       HospitalName
	pointsEarned   Int              @default(100)
	historyDetails DonationHistory?
	createdAt      DateTime         @default(now())
}

model DonationHistory {
	id           String        @id @default(uuid())
	donation     Donation      @relation(fields: [donationId], references: [id])
	donationId   String        @unique
	usageDetails UsageDetail[]
	createdAt    DateTime      @default(now())
}

model UsageDetail {
	id           String          @id @default(uuid())
	history      DonationHistory @relation(fields: [historyId], references: [id])
	historyId    String
	patientType  PatientType
	usage        UsageDescription
	date         DateTime
	hospital     HospitalName
}

model UserBadge {
	id       String   @id @default(uuid())
	user     User     @relation(fields: [userId], references: [id])
	userId   String
	badgeId  String   // ID do badge (referência às constantes, não FK)
	earnedAt DateTime @default(now())
	
	@@unique([userId, badgeId])
}

model Level {
	level      Int      @id
	name       String
	minPoints  Int
	maxPoints  Int
	benefits   Json
	createdAt  DateTime @default(now())
}

enum NotificationType {
	DONATION_REMINDER
	BADGE_EARNED
	LEVEL_UP
	CAMPAIGN_ALERT
	NEXT_DONATION_AVAILABLE
}

enum NotificationStatus {
	PENDING
	SENT
	FAILED
	READ
}

model Notification {
	id        String             @id @default(uuid())
	user      User               @relation(fields: [userId], references: [id])
	userId    String
	type      NotificationType
	title     String
	body      String
	data      Json?
	status    NotificationStatus @default(PENDING)
	sentAt    DateTime?
	readAt    DateTime?
	createdAt DateTime           @default(now())
	
	@@index([userId, status])
	@@index([createdAt])
}
